openapi: 3.1.0
info: {title: OpenAPI definition, version: v0}
servers:
- {url: 'http://localhost:8080', description: Generated server url}
paths:
  /api/analysis/{course}/{exercise}/recompute:
    post:
      tags: [analysis-resource]
      operationId: recompute
      parameters:
      - name: course
        in: path
        required: true
        schema: {type: string}
      - name: exercise
        in: path
        required: true
        schema: {type: string}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {type: string}
  /api/analysis/{exerciseId}/cancel:
    post:
      tags: [analysis-resource]
      operationId: cancelAnalysis
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/AnalysisStatusDTO'}
  /api/analysis/{exerciseId}/clear:
    delete:
      tags: [analysis-resource]
      operationId: clearData
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      - name: type
        in: query
        required: false
        schema: {type: string, default: both}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {type: string}
  /api/analysis/{exerciseId}/status:
    get:
      tags: [analysis-resource]
      operationId: getStatus
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/AnalysisStatusDTO'}
  /api/attendance/clear:
    post:
      tags: [attendance-resource]
      operationId: clearAttendancePost
      parameters:
      - name: exerciseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {type: string}
    delete:
      tags: [attendance-resource]
      operationId: clearAttendance
      parameters:
      - name: exerciseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {type: string}
  /api/attendance/upload:
    post:
      tags: [attendance-resource]
      operationId: uploadAttendance
      parameters:
      - name: courseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      - name: exerciseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      - name: jwt
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_server_url
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_username
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_password
        in: cookie
        required: false
        schema: {type: string}
      - name: serverUrl
        in: query
        required: false
        schema: {type: string}
      - name: username
        in: query
        required: false
        schema: {type: string}
      - name: password
        in: query
        required: false
        schema: {type: string}
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file: {type: string, format: binary}
              required: [file]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/TeamsScheduleDTO'}
  /api/auth/login:
    post:
      tags: [auth-resource]
      operationId: login
      requestBody:
        content:
          application/json:
            schema: {$ref: '#/components/schemas/LoginRequestDTO'}
        required: true
      responses:
        '200': {description: OK}
  /api/config/projects:
    get:
      tags: [config-resource]
      operationId: getProjects
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/Project'}
  /api/requestResource/fetchData:
    get:
      tags: [request-resource]
      operationId: fetchData
      parameters:
      - name: exerciseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      - name: jwt
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_server_url
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_username
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_password
        in: cookie
        required: false
        schema: {type: string}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/ClientResponseDTO'}
  /api/requestResource/hasData/{exerciseId}:
    get:
      tags: [request-resource]
      operationId: hasAnalyzedData
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: {type: boolean}
  /api/requestResource/stream:
    get:
      tags: [request-resource]
      operationId: streamAnalysis
      parameters:
      - name: exerciseId
        in: query
        required: true
        schema: {type: integer, format: int64}
      - name: jwt
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_server_url
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_username
        in: cookie
        required: false
        schema: {type: string}
      - name: artemis_password
        in: cookie
        required: false
        schema: {type: string}
      responses:
        '200':
          description: OK
          content:
            text/event-stream:
              schema: {$ref: '#/components/schemas/SseEmitter'}
  /api/requestResource/teams/{exerciseId}:
    get:
      tags: [request-resource]
      operationId: getTeamsByExercise
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/ClientResponseDTO'}
  /api/requestResource/{exerciseId}/getData:
    get:
      tags: [request-resource]
      operationId: getData
      parameters:
      - name: exerciseId
        in: path
        required: true
        schema: {type: integer, format: int64}
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/ClientResponseDTO'}
components:
  schemas:
    AnalysisStatusDTO:
      type: object
      properties:
        currentStage: {type: string}
        currentTeamName: {type: string}
        errorMessage: {type: string}
        exerciseId: {type: integer, format: int64}
        lastUpdatedAt: {type: string, format: date-time}
        processedTeams: {type: integer, format: int32}
        startedAt: {type: string, format: date-time}
        state: {type: string}
        totalTeams: {type: integer, format: int32}
    AnalyzedChunkDTO:
      type: object
      properties:
        authorEmail: {type: string}
        authorName: {type: string}
        chunkIndex: {type: integer, format: int32}
        classification: {type: string}
        commitMessages:
          type: array
          items: {type: string}
        commitShas:
          type: array
          items: {type: string}
        complexity: {type: number, format: double}
        confidence: {type: number, format: double}
        effortScore: {type: number, format: double}
        errorMessage: {type: string}
        id: {type: string}
        isBundled: {type: boolean}
        isError: {type: boolean}
        isExternalContributor: {type: boolean}
        linesChanged: {type: integer, format: int32}
        llmTokenUsage: {$ref: '#/components/schemas/LlmTokenUsage'}
        novelty: {type: number, format: double}
        reasoning: {type: string}
        timestamp: {type: string, format: date-time}
        totalChunks: {type: integer, format: int32}
    CQIPenaltyDTO:
      type: object
      properties:
        multiplier: {type: number, format: double}
        reason: {type: string}
        type: {type: string}
    CQIResultDTO:
      type: object
      properties:
        baseScore: {type: number, format: double}
        components: {$ref: '#/components/schemas/ComponentScoresDTO'}
        cqi: {type: number, format: double}
        filterSummary: {$ref: '#/components/schemas/FilterSummaryDTO'}
        penalties:
          type: array
          items: {$ref: '#/components/schemas/CQIPenaltyDTO'}
        penaltyMultiplier: {type: number, format: double}
        weights: {$ref: '#/components/schemas/ComponentWeightsDTO'}
    ClientResponseDTO:
      type: object
      properties:
        analysisHistory:
          type: array
          items: {$ref: '#/components/schemas/AnalyzedChunkDTO'}
        analysisStatus:
          type: string
          enum: [PENDING, DOWNLOADING, GIT_ANALYZING, GIT_DONE, AI_ANALYZING, ANALYZING,
            DONE, ERROR, CANCELLED]
        cqi: {type: number, format: double}
        cqiDetails: {$ref: '#/components/schemas/CQIResultDTO'}
        isSuspicious: {type: boolean}
        llmTokenTotals: {$ref: '#/components/schemas/LlmTokenTotals'}
        orphanCommits:
          type: array
          items: {$ref: '#/components/schemas/OrphanCommitDTO'}
        students:
          type: array
          items: {$ref: '#/components/schemas/StudentAnalysisDTO'}
        submissionCount: {type: integer, format: int32}
        teamId: {type: integer, format: int64}
        teamName: {type: string}
        tutor: {type: string}
    ComponentScoresDTO:
      type: object
      properties:
        effortBalance: {type: number, format: double}
        locBalance: {type: number, format: double}
        ownershipSpread: {type: number, format: double}
        pairProgramming: {type: number, format: double}
        pairProgrammingStatus: {type: string}
        temporalSpread: {type: number, format: double}
    ComponentWeightsDTO:
      type: object
      properties:
        effortBalance: {type: number, format: double}
        locBalance: {type: number, format: double}
        ownershipSpread: {type: number, format: double}
        temporalSpread: {type: number, format: double}
    FilterSummaryDTO:
      type: object
      properties:
        autoGeneratedCount: {type: integer, format: int32}
        emptyCount: {type: integer, format: int32}
        filteredPercentage: {type: number, format: double}
        formatOnlyCount: {type: integer, format: int32}
        massReformatCount: {type: integer, format: int32}
        mergeCount: {type: integer, format: int32}
        productiveCommits: {type: integer, format: int32}
        renameOnlyCount: {type: integer, format: int32}
        revertCount: {type: integer, format: int32}
        totalCommits: {type: integer, format: int32}
        totalFiltered: {type: integer, format: int32}
        trivialCount: {type: integer, format: int32}
    LlmTokenTotals:
      type: object
      properties:
        callsWithUsage: {type: integer, format: int64}
        completionTokens: {type: integer, format: int64}
        llmCalls: {type: integer, format: int64}
        promptTokens: {type: integer, format: int64}
        totalTokens: {type: integer, format: int64}
    LlmTokenUsage:
      type: object
      properties:
        completionTokens: {type: integer, format: int64}
        model: {type: string}
        promptTokens: {type: integer, format: int64}
        totalTokens: {type: integer, format: int64}
        usageAvailable: {type: boolean}
    LoginRequestDTO:
      type: object
      properties:
        courseId: {type: string, minLength: 1}
        password: {type: string, minLength: 1}
        serverUrl: {type: string, minLength: 1}
        username: {type: string, minLength: 1}
      required: [courseId, password, serverUrl, username]
    OrphanCommitDTO:
      type: object
      properties:
        authorEmail: {type: string}
        authorName: {type: string}
        commitHash: {type: string}
        linesAdded: {type: integer, format: int32}
        linesDeleted: {type: integer, format: int32}
        message: {type: string}
        timestamp: {type: string, format: date-time}
    Project:
      type: object
      properties:
        courseName: {type: string}
        exerciseId: {type: integer, format: int64}
        gitRepoPath: {type: string}
        id: {type: string}
        semester: {type: string}
    SseEmitter:
      type: object
      properties:
        timeout: {type: integer, format: int64}
    StudentAnalysisDTO:
      type: object
      properties:
        commitCount: {type: integer, format: int32}
        linesAdded: {type: integer, format: int32}
        linesChanged: {type: integer, format: int32}
        linesDeleted: {type: integer, format: int32}
        name: {type: string}
    TeamAttendanceDTO:
      type: object
      properties:
        pairedMandatorySessions: {type: boolean}
        pairedSessions:
          type: array
          items: {type: string, format: date-time}
        student1Attendance:
          type: object
          additionalProperties: {type: boolean}
        student2Attendance:
          type: object
          additionalProperties: {type: boolean}
    TeamsScheduleDTO:
      type: object
      properties:
        teams:
          type: object
          additionalProperties: {$ref: '#/components/schemas/TeamAttendanceDTO'}
